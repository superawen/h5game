window.__require=function t(e,i,a){function s(l,o){if(!i[l]){if(!e[l]){var n=l.split("/");if(n=n[n.length-1],!e[n]){var r="function"==typeof __require&&__require;if(!o&&r)return r(n,!0);if(c)return c(n,!0);throw new Error("Cannot find module '"+l+"'")}l=n}var h=i[l]={exports:{}};e[l][0].call(h.exports,function(t){return s(e[l][1][t]||t)},h,h.exports,t,e,i,a)}return i[l].exports}for(var c="function"==typeof __require&&__require,l=0;l<a.length;l++)s(a[l]);return s}({LevelItem:[function(t,e){"use strict";cc._RF.push(e,"ae408IqDF5DFo8na+52hGjt","LevelItem"),cc.Class({extends:cc.Component,properties:{nodeBg:cc.Node,nodeStar:cc.Node,lockLevel:cc.Label,unlockLevel:cc.Label},setItem:function(t,e,i,a){this.nodeBg.attr({_level_:a}),t?(this.nodeBg.getComponent(cc.Sprite).spriteFrame=i.getSpriteFrame("pass_bg"),this.nodeStar.active=!0,this.nodeStar.getComponent(cc.Sprite).spriteFrame=i.getSpriteFrame("point"+e),this.nodeBg.getComponent(cc.Button).interactable=!0,this.lockLevel.node.active=!1,this.unlockLevel.node.active=!0):(this.nodeBg.getComponent(cc.Sprite).spriteFrame=i.getSpriteFrame("lock"),this.nodeStar.active=!1,this.nodeBg.getComponent(cc.Button).interactable=!1,this.lockLevel.node.active=!0,this.unlockLevel.node.active=!1),this.lockLevel.string=a,this.unlockLevel.string=a},btnCallBack:function(){this._callfunc&&this._callfunc(this.nodeBg._level_)},levelFunc:function(t){this._callfunc=t}}),cc._RF.pop()},{}],Main:[function(t,e){"use strict";cc._RF.push(e,"8bdddCze2RD97IUN7F/EblH","Main");var i="Texture/sound/button",a={player:[],box:[]};cc.Class({extends:cc.Component,properties:{bg:cc.Node,menuLayer:cc.Node,levelLayer:cc.Node,gameLayer:cc.Node,gameControlLayer:cc.Node,gameOverLayer:cc.Node,startBtn:cc.Node,loadingTxt:cc.Node,levelScroll:cc.Node,levelContent:cc.Node,levelTxt:cc.Node,curNum:cc.Node,bestNum:cc.Node,itemImgAtlas:cc.SpriteAtlas,levelImgAtlas:cc.SpriteAtlas,levelItemPrefab:cc.Prefab},onLoad:function(){cc.debug.setDisplayStats(!1),this.curLayer=0,this.clearGameData(),this.initData(),this.menuLayer.active=!0,this.levelLayer.active=!1,this.gameLayer.active=!1,this.gameOverLayer.active=!1,this.loadingTxt.active=!0,this.startBtn.getComponent(cc.Button).interactable=!1;var t=cc.view.getCanvasSize(),e=t.width/t.height;this.bg.height=.5625/e*1280,this.btnStartAnim()},initData:function(){this.boxWidth=90,this.boxHeight=90,this.allWidth=720,this.allHeight=1280,this.allRow=8,this.allCol=8,this.allLevelCount=0,this.allLevelConfig={},this.allObjJosn={},cc.loader.loadRes("levelConfig_test.json",function(t,e){t?console.log(t):(this.allObjJosn=e.json,this.allLevelConfig=e.json.level,this.allLevelCount=e.json.levelCount,this.loadingTxt.active=!1,this.startBtn.getComponent(cc.Button).interactable=!0,this.createLavelItem())}.bind(this)),this.tabLevel=[]},createLavelItem:function(){for(var t=function(t){this.selectLevelCallBack(t)}.bind(this),e=0;e<this.allLevelCount;e++){var i=cc.instantiate(this.levelItemPrefab);i.parent=this.levelScroll;var a=i.getComponent("LevelItem");a.levelFunc(t),this.tabLevel.push(a)}this.levelContent.height=135*Math.ceil(this.allLevelCount/5)+20},updateLevelInfo:function(){for(var t=parseInt(cc.sys.localStorage.getItem("finishLevel")||0),e=1;e<=this.allLevelCount;e++)if(e<=t){var i=parseInt(cc.sys.localStorage.getItem("levelStar"+e)||0);this.tabLevel[e-1].setItem(!0,i,this.levelImgAtlas,e)}else e==t+1?this.tabLevel[e-1].setItem(!0,0,this.levelImgAtlas,e):this.tabLevel[e-1].setItem(!1,0,this.levelImgAtlas,e)},btnStartAnim:function(){var t=cc.rotateTo(.1,3),e=cc.rotateTo(.2,-6),i=cc.rotateTo(.2,6),a=cc.rotateTo(.1,0),s=cc.delayTime(1),c=cc.sequence(t,e,i,a,s),l=cc.repeatForever(c);this.startBtn.stopAllActions(),this.startBtn.runAction(l)},startBtnCallBack:function(){1!=this.curLayer&&(this.playSound(i),this.curLayer=1,this.menuLayer.runAction(cc.sequence(cc.fadeOut(.1),cc.callFunc(function(){this.startBtn.stopAllActions(),this.startBtn.scale=1,this.menuLayer.opacity=255,this.menuLayer.active=!1},this))),this.levelLayer.active=!0,this.levelLayer.opacity=0,this.levelLayer.runAction(cc.sequence(cc.delayTime(.1),cc.fadeIn(.1),cc.callFunc(function(){this.updateLevelInfo()},this))))},levelBackCallBack:function(){0!=this.curLayer&&(this.playSound(i),this.curLayer=0,this.levelLayer.runAction(cc.sequence(cc.fadeOut(.1),cc.callFunc(function(){this.levelLayer.opacity=255,this.levelLayer.active=!1},this))),this.menuLayer.active=!0,this.menuLayer.opacity=0,this.menuLayer.runAction(cc.sequence(cc.delayTime(.1),cc.fadeIn(.1))),this.btnStartAnim())},selectLevelCallBack:function(t){2!=this.curLayer&&(this.curLevel=t,this.playSound(i),this.curLayer=2,this.levelLayer.runAction(cc.sequence(cc.fadeOut(.1),cc.callFunc(function(){this.levelLayer.opacity=255,this.levelLayer.active=!1},this))),this.gameLayer.active=!0,this.gameLayer.opacity=0,this.gameLayer.runAction(cc.sequence(cc.delayTime(.1),cc.callFunc(function(){this.createLevelLayer(t)},this),cc.fadeIn(.1))))},backLevelCallBack:function(){this.clearGameData(),1!=this.curLayer&&(this.playSound(i),this.curLayer=1,this.gameLayer.runAction(cc.sequence(cc.fadeOut(.1),cc.callFunc(function(){this.gameLayer.opacity=255,this.gameLayer.active=!1},this))),this.levelLayer.active=!0,this.levelLayer.opacity=0,this.levelLayer.runAction(cc.sequence(cc.fadeIn(.1),cc.callFunc(function(){this.updateLevelInfo()},this))))},nextLevelCallBack:function(){this.playSound(i),this.gameOverLayer.active=!1,this.curLevel=this.curLevel+1,this.curLevel>this.allLevelCount?this.backLevelCallBack():this.createLevelLayer(this.curLevel)},refreshCallBack:function(){this.playSound(i),this.gameLayer.stopAllActions(),this.clearGameData(),this.createLevelLayer(this.curLevel)},revokeCallBack:function(){var t=a.player.pop();void 0!==t&&(!0===t[3].type?this.boxCancel(t):this.clickCallBack_f(t))},createLevelLayer:function(t){this.deleteCancelData(),this.gameControlLayer.removeAllChildren(),this.setLevel(),this.setCurNum(),this.setBestNum();var e=this.allLevelConfig[t].content;this.allRow=this.allLevelConfig[t].allRow,this.allCol=this.allLevelConfig[t].allCol,this.heroRow=this.allLevelConfig[t].heroRow,this.heroCol=this.allLevelConfig[t].heroCol,this.boxW=this.allWidth/this.allCol,this.boxH=this.boxW;var i=-this.allWidth/2+this.boxW/2,a=this.allWidth/2-this.boxW/2,s=0;this.allRow,this.allCol,s=(this.allRow-this.allCol)*this.boxH/2,this.landArrays=[],this.palace=[];for(var c=0;c<this.allRow;c++)this.landArrays[c]=[],this.palace[c]=[];for(var l=0;l<this.allRow;l++)for(var o=0;o<this.allCol;o++){var n=i+this.boxW*o,r=a-this.boxH*l+s,h=this.createBoxItem(l,o,e[l*this.allCol+o],cc.v2(n,r));this.landArrays[l][o]=h,h.width=this.boxW,h.height=this.boxH}this.setLandFrame(this.heroRow,this.heroCol,6)},createBoxItem:function(t,e,i,a){var s=new cc.Node,c=s.addComponent(cc.Sprite),l=s.addComponent(cc.Button);return c.spriteFrame=this.itemImgAtlas.getSpriteFrame("p"+i),s.parent=this.gameControlLayer,s.position=a,1==i?(s.name="wall_"+t+"_"+e,s.attr({_type_:i})):0==i?(s.name="none_"+t+"_"+e,s.attr({_type_:i})):(s.name="land_"+t+"_"+e,s.attr({_type_:i}),s.attr({_row_:t}),s.attr({_col_:e}),l.interactable=!0,l.target=s,l.node.on("click",this.clickCallBack,this),5==i&&(this.finishBoxCount+=1)),this.palace[t][e]=i,s},clickCallBack:function(t){var e=t.target;this.minPath=this.allCol*this.allRow+1,this.bestMap=[],this.end={},this.end.row=e._row_,this.end.col=e._col_,this.start={},this.start.row=this.heroRow,this.start.col=this.heroCol;var i=this.palace[this.end.row][this.end.col];if(2==i||3==i)this.getPath(this.start,0,[]),this.minPath<=this.allCol*this.allRow&&(this.bestMap.unshift(this.start),this.runHero(this.start));else if(4==i||5==i){var a=this.end.row-this.start.row,s=this.end.col-this.start.col;if(Math.abs(a)+Math.abs(s)==1){var c=this.end.row+a,l=this.end.col+s,o=this.palace[c][l];if(o&&1!=o&&4!=o&&5!=o){this.playSound("Texture/sound/pushbox"),this.setLandFrame(this.start.row,this.start.col,this.palace[this.start.row][this.start.col]);var n=4;5==this.palace[this.end.row][this.end.col]?(this.palace[this.end.row][this.end.col]=3,n=5,this.finishBoxCount-=1):this.palace[this.end.row][this.end.col]=2,this.setLandFrame(this.end.row,this.end.col,6);var r=this.palace[c][l];3==r?(this.palace[c][l]=5,this.finishBoxCount+=1):this.palace[c][l]=4,this.setLandFrame(c,l,this.palace[c][l]);var h={row:c,col:l,type:r},u={row:this.end.row,col:this.end.col,type:n},v=JSON.stringify([this.start,u,h,{type:!0}]);this.setPlayerPositionInfo(v),this.curStepNum+=1,this.setCurNum(),this.heroRow=this.end.row,this.heroCol=this.end.col,this.checkGameOver()}else this.playSound("Texture/sound/wrong")}else this.playSound("Texture/sound/wrong")}},getPath:function(t,e,i){if(t.row==this.end.row&&t.col==this.end.col&&e<this.minPath){this.bestMap=[];for(var a=0;a<i.length;a++)this.bestMap.push(i[a]);this.minPath=e,i=[]}for(var s=t.row-1;s<=t.row+1;s++)for(var c=t.col-1;c<=t.col+1;c++)if(!(s<0||s>=this.allRow||c<0||c>=this.allCol)&&(s==t.row||c==t.col)&&this.palace[s][c]&&(2==this.palace[s][c]||3==this.palace[s][c])){var l=this.palace[s][c];this.palace[s][c]=1;var o={};o.row=s,o.col=c,i.push(o),this.getPath(o,e+1,i),this.palace[s][c]=l,i.pop()}},runHero:function(){var t=this;this.setLandEnable(!1);for(var e=[],i=function(i){e.push(cc.delayTime(.1)),e.push(cc.callFunc(function(){var t=this.bestMap[i];this.setLandFrame(t.row,t.col,6);var e=this.bestMap[i-1];this.setLandFrame(e.row,e.col,this.palace[e.row][e.col]);var a=JSON.stringify([e,t,{},{type:!1}]);this.setPlayerPositionInfo(a),this.curStepNum+=1,this.playSound("Texture/sound/move"),this.setCurNum()},t))},a=1;a<this.bestMap.length;a++)i(a);e.push(cc.callFunc(function(){this.heroRow=this.end.row,this.heroCol=this.end.col,this.setLandEnable(!0)},this)),e.length>=2?this.gameLayer.runAction(cc.sequence(e)):this.setLandEnable(!0)},setLandEnable:function(t){for(var e=0;e<this.allRow;e++)for(var i=0;i<this.allCol;i++){var a=this.landArrays[e][i];a&&(a.getComponent(cc.Button).interactable=t)}},setLandFrame:function(t,e,i){var a=this.landArrays[t][e];a&&(a.getComponent(cc.Sprite).spriteFrame=this.itemImgAtlas.getSpriteFrame("p"+i),a.width=this.boxW,a.height=this.boxH)},checkGameOver:function(){var t=this.allLevelConfig[this.curLevel].allBox;if(this.finishBoxCount==t){this.gameOverLayer.active=!0,this.gameOverLayer.opacity=1,this.gameOverLayer.runAction(cc.sequence(cc.delayTime(.5),cc.fadeIn(.1)));var e=parseInt(cc.sys.localStorage.getItem("finishLevel")||0);this.curLevel>e&&cc.sys.localStorage.setItem("finishLevel",this.curLevel),cc.sys.localStorage.setItem("levelStar"+this.curLevel,3);var i=parseInt(cc.sys.localStorage.getItem("levelBest"+this.curLevel)||0);(this.curStepNum<i||0==i)&&cc.sys.localStorage.setItem("levelBest"+this.curLevel,this.curStepNum),this.playSound("Texture/sound/gamewin"),this.clearGameData()}},setLevel:function(){this.levelTxt.getComponent(cc.Label).string=this.curLevel},setCurNum:function(){this.curNum.getComponent(cc.Label).string=this.curStepNum},setBestNum:function(){var t=cc.sys.localStorage.getItem("levelBest"+this.curLevel)||"--";this.bestNum.getComponent(cc.Label).string=t},clearGameData:function(){this.finishBoxCount=0,this.curStepNum=0,this.curStepNum=0},playSound:function(t){cc.loader.loadRes(t,cc.AudioClip,function(t,e){null!=e&&cc.audioEngine.playEffect(e,!1)})},setPlayerPositionInfo:function(t){var e=JSON.parse(t);a.player.push(e)},runHero_f:function(){var t=this;this.setLandEnable(!1);for(var e=[],i=function(i){e.push(cc.delayTime(.1)),e.push(cc.callFunc(function(){var t=this.bestMap[i];this.setLandFrame(t.row,t.col,6);var e=this.bestMap[i-1];this.setLandFrame(e.row,e.col,this.palace[e.row][e.col]),this.curStepNum-=1,this.playSound("Texture/sound/move"),this.setCurNum()},t))},a=1;a<this.bestMap.length;a++)i(a);e.push(cc.callFunc(function(){this.heroRow=this.end.row,this.heroCol=this.end.col,this.setLandEnable(!0)},this)),e.length>=2?this.gameLayer.runAction(cc.sequence(e)):this.setLandEnable(!0)},clickCallBack_f:function(t){if(void 0!==t){var e={};e._row_=t[0].row,e._col_=t[0].col,this.minPath=this.allCol*this.allRow+1,this.bestMap=[],this.end={},this.end.row=e._row_,this.end.col=e._col_,this.start={},this.start.row=this.heroRow,this.start.col=this.heroCol;var i=this.palace[this.end.row][this.end.col];2!=i&&3!=i||(this.getPath(this.start,0,[]),this.minPath<=this.allCol*this.allRow&&(this.bestMap.unshift(this.start),this.runHero_f(this.start)))}},boxCancel:function(t){this.setLandFrame(t[0].row,t[0].col,6),this.setLandFrame(t[1].row,t[1].col,t[1].type),this.setLandFrame(t[2].row,t[2].col,t[2].type),this.palace[t[1].row][t[1].col]=t[1].type,this.palace[t[2].row][t[2].col]=t[2].type,this.heroRow=t[0].row,this.heroCol=t[0].col,this.curStepNum-=1,!(this.curStepNum<=0)&&this.curStepNum,this.playSound("Texture/sound/move"),this.setCurNum()},deleteCancelData:function(){a={player:[],box:[]}}}),cc._RF.pop()},{}],use_reversed_rotateTo:[function(t,e){"use strict";cc._RF.push(e,"708cc+74nBLqqC6KcqvIO/q","use_reversed_rotateTo"),cc.RotateTo._reverse=!0,cc._RF.pop()},{}]},{},["LevelItem","Main","use_reversed_rotateTo"]);