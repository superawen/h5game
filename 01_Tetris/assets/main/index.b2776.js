window.__require=function t(e,o,i){function n(c,s){if(!o[c]){if(!e[c]){var a=c.split("/");if(a=a[a.length-1],!e[a]){var l="function"==typeof __require&&__require;if(!s&&l)return l(a,!0);if(r)return r(a,!0);throw new Error("Cannot find module '"+c+"'")}c=a}var h=o[c]={exports:{}};e[c][0].call(h.exports,function(t){return n(e[c][1][t]||t)},h,h.exports,t,e,o,i)}return o[c].exports}for(var r="function"==typeof __require&&__require,c=0;c<i.length;c++)n(i[c]);return n}({BlockConfig:[function(t,e,o){"use strict";cc._RF.push(e,"7c9c80EzVJCVLRYhB7J8htZ","BlockConfig"),Object.defineProperty(o,"__esModule",{value:!0}),o.BlockConfig=void 0,o.BlockConfig=[[[[1,1],[1,1]]],[[[1,1,1,1]],[[1],[1],[1],[1]]],[[[0,1],[1,1],[0,1]],[[1,1,1],[0,1,0]],[[1,0],[1,1],[1,0]],[[0,1,0],[1,1,1]]],[[[1,0],[1,1],[0,1]],[[0,1,1],[1,1,0]]],[[[0,1],[1,1],[1,0]],[[1,1,0],[0,1,1]]],[[[1,1],[0,1],[0,1]],[[1,1,1],[1,0,0]],[[1,0],[1,0],[1,1]],[[0,0,1],[1,1,1]]],[[[1,1],[1,0],[1,0]],[[1,0,0],[1,1,1]],[[0,1],[0,1],[1,1]],[[1,1,1],[0,0,1]]],[[[1,1]],[[1],[1]]],[[[1,1],[0,1]],[[1,1],[1,0]],[[1,0],[1,1]],[[0,1],[1,1]]],[[[1,1,1],[1,0,0],[1,0,0]],[[1,0,0],[1,0,0],[1,1,1]],[[0,0,1],[0,0,1],[1,1,1]],[[1,1,1],[0,0,1],[0,0,1]]],[[[0,0,1],[1,1,1],[0,0,1]],[[1,1,1],[0,1,0],[0,1,0]],[[1,0,0],[1,1,1],[1,0,0]],[[0,1,0],[0,1,0],[1,1,1]]],[[[1,1,1],[1,0,1],[1,0,1]],[[1,1,1],[1,0,0],[1,1,1]],[[1,0,1],[1,0,1],[1,1,1]],[[1,1,1],[0,0,1],[1,1,1]]],[[[1,1],[1,1],[0,1]],[[1,1,1],[1,1,0]],[[1,0],[1,1],[1,1]],[[0,1,1],[1,1,1]]],[[[1,1],[1,1],[1,0]],[[1,1,0],[1,1,1]],[[0,1],[1,1],[1,1]],[[1,1,1],[0,1,1]]]],cc._RF.pop()},{}],BlockManager:[function(t,e,o){"use strict";cc._RF.push(e,"60be0HvLHxNlalav7TA6mbh","BlockManager"),Object.defineProperty(o,"__esModule",{value:!0}),o.BlockManager=void 0;var i=t("./BlockConfig"),n=t("./Block"),r=function(){function t(){this._gridPrefab=null,this._curBlock=null,this._nextBlock=null}return t.getInstance=function(){return null==this.instance&&(this.instance=new t),this.instance},Object.defineProperty(t.prototype,"GridPrefab",{get:function(){return this._gridPrefab},set:function(t){this._gridPrefab=t},enumerable:!1,configurable:!0}),t.prototype.nextBlock=function(t,e){return this._nextBlock=this.create(t,e),this._nextBlock},t.prototype.newBlock=function(t,e){return null!=this._nextBlock&&(this._curBlock=this._nextBlock),null==this._curBlock&&(this._curBlock=this.create(t,e)),this._curBlock},Object.defineProperty(t.prototype,"CurBlock",{get:function(){return this._curBlock},enumerable:!1,configurable:!0}),t.prototype.clear=function(){this._curBlock=null,this._nextBlock=null},t.prototype.create=function(t,e){var o;return o=t?Math.floor(Math.random()*i.BlockConfig.length):Math.floor(7*Math.random()),new n.Block(o,e)},t}();o.BlockManager=r,cc._RF.pop()},{"./Block":"Block","./BlockConfig":"BlockConfig"}],Block:[function(t,e,o){"use strict";cc._RF.push(e,"f88e4ks1XRAYY5B6uquqzwu","Block"),Object.defineProperty(o,"__esModule",{value:!0}),o.Block=void 0;var i=t("./Grid"),n=t("./BlockConfig"),r=function(){function t(t,e){void 0===e&&(e=!1),this.MAP_COL=12,this.SIZE=32,this._config=null,this._type=0,this._isColor=!1,this._dicretion=0,this._grids=[],this._type=t,this._isColor=e,this._config=n.BlockConfig[t],this._dicretion=Math.floor(Math.random()*this._config.length)}return Object.defineProperty(t.prototype,"Type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Row",{get:function(){return this._config[this._dicretion].length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Col",{get:function(){return this._config[this._dicretion][0].length},enumerable:!1,configurable:!0}),t.prototype.rotate=function(){var t=this._config.length;if(1!=t){this._dicretion=(this._dicretion+1)%t;for(var e=this._config[this._dicretion],o=0,i=0,n=0;n<e.length;n++)for(var r=0;r<e[n].length;r++)if(e[n][r]>0){if(this._grids[o].setRowCol(n,r),this._grids[o].resetPosition(),this._grids[o].RealCol>=this.MAP_COL){var c=this._grids[o].RealCol+1-this.MAP_COL;i<c&&(i=c)}o++}if(i>0)for(n=0;n<this._grids.length;n++)this._grids[n].MapCol-=i,this._grids[n].resetPosition()}},t.prototype.getGrids=function(){if(0==this._grids.length)for(var t=this._config[this._dicretion],e=new cc.Color(this.getRandColor(),this.getRandColor(),this.getRandColor()),o=0;o<t.length;o++)for(var n=0;n<t[o].length;n++)if(t[o][n]>0){var r=new i.Grid(o,n,e);this._grids.push(r)}return this._grids},t.prototype.getRandColor=function(){return 0==this._isColor?200:Math.floor(100*Math.random())+155},t}();o.Block=r,cc._RF.pop()},{"./BlockConfig":"BlockConfig","./Grid":"Grid"}],Game:[function(t,e,o){"use strict";cc._RF.push(e,"e1b90/rohdEk4SdmmEZANaD","Game");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,c=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(c=(r<3?n(c):r>3?n(e,o,c):n(e,o))||c);return r>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var c=t("./BlockManager"),s=t("./Grid"),a=cc._decorator,l=a.ccclass,h=a.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.nodeGame=null,e.nodeNext=null,e.labelScore=null,e.prefabGrid=null,e.nodeIntro=null,e.sliderSpeed=null,e.nodeLine=null,e.toggleLine=null,e.toggleColor=null,e.toggleMultiType=null,e.toggleStepByStep=null,e.panelGameStart=null,e.panelGameOver=null,e.NEXT_SIZE=6,e.MAP_ROW=32,e.MAP_COL=12,e.mapData=[],e.isRunning=!1,e.score=0,e.runIndex=0,e.keyDown=!1,e}return n(e,t),e.prototype.onLoad=function(){cc.debug.setDisplayStats(!1),c.BlockManager.getInstance().GridPrefab=this.prefabGrid,this.initGame(),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this),this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this)},e.prototype.onDestroy=function(){cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this),this.node.off(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.off(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this)},e.prototype.initGame=function(){this.nodeIntro.active=!1;for(var t=0;t<this.MAP_ROW*this.MAP_COL;t++)this.mapData[t]=null},e.prototype.startGame=function(){this.score=0,this.labelScore.string=this.score.toString(),this.keyDown=!1,this.nodeGame.removeAllChildren(),this.nodeNext.removeAllChildren();for(var t=0;t<this.mapData.length;t++)null!=this.mapData[t]&&(this.mapData[t].remove(),this.mapData[t]=null);this.setCurBlock(),this.nextBlock(),this.isRunning=!0},e.prototype.setCurBlock=function(){for(var t=c.BlockManager.getInstance().newBlock(this.toggleMultiType.isChecked,this.toggleColor.isChecked),e=Math.floor((this.MAP_COL-t.Col)/2),o=0;o<t.getGrids().length;o++){var i=t.getGrids()[o];i.IsFalling=!0,i.MapRow=this.MAP_ROW,i.MapCol=e,i.resetPosition(),i.Node.parent=this.nodeGame}},e.prototype.nextBlock=function(){this.nodeNext.removeAllChildren();for(var t=c.BlockManager.getInstance().nextBlock(this.toggleMultiType.isChecked,this.toggleColor.isChecked),e=(this.NEXT_SIZE-t.Row)/2,o=(this.NEXT_SIZE-t.Col)/2,i=0;i<t.getGrids().length;i++){var n=t.getGrids()[i];n.MapRow=e,n.MapCol=o,n.resetPosition(),this.nodeNext.addChild(n.Node)}},e.prototype.update=function(){if(this.isRunning){this.runIndex++;var t=1-this.sliderSpeed.progress;if(this.keyDown&&(t=0),this.runIndex>50*t){this.runIndex=0;var e=c.BlockManager.getInstance().CurBlock;if(this.canFall(e))for(var o=0;o<e.getGrids().length;o++)(i=e.getGrids()[o]).MapRow-=1,i.resetPosition();else if(this.isGameOver(e))this.isRunning=!1,this.panelGameOver.active=!0;else{for(o=0;o<e.getGrids().length;o++){var i=e.getGrids()[o];this.setMapGrid(i)}0==this.checkClearLine()&&(this.addRow(),this.setCurBlock(),this.nextBlock())}}}},e.prototype.canFall=function(t){for(var e=0;e<t.getGrids().length;e++){var o=t.getGrids()[e];if(o.RealRow<=0)return!1;var i=this.getMapGrid(o.RealRow-1,o.RealCol);if(null!=i&&0==i.IsFalling)return!1}return!0},e.prototype.moveHorizontal=function(t){for(var e=c.BlockManager.getInstance().CurBlock,o=!0,i=0;i<e.getGrids().length;i++){var n=e.getGrids()[i];if(t<0&&n.RealCol<=0||t>0&&n.RealCol>=this.MAP_COL-1){o=!1;break}var r=this.getMapGrid(n.RealRow,n.RealCol+t);if(null!=r&&0==r.IsFalling){o=!1;break}}if(o)for(i=0;i<e.getGrids().length;i++)(n=e.getGrids()[i]).MapCol+=t,n.resetPosition()},e.prototype.checkClearLine=function(){for(var t=[],e=0;e<this.MAP_ROW;e++){for(var o=!0,i=0;i<this.MAP_COL;i++)null==this.getMapGrid(e,i)&&(o=!1);if(o)for(t.push(e),i=0;i<this.MAP_COL;i++)this.getMapGrid(e,i).remove(),this.clearMapGrid(e,i)}var n=t.length;return n>0&&(t.reverse(),this.isRunning=!1,this.score+=n,n>1&&(this.score+=Math.floor(n/2)),this.labelScore.string=this.score.toString(),this.labelScore.node.runAction(cc.sequence(cc.scaleTo(.5,1.5),cc.scaleTo(.5,1.2))),this.scheduleOnce(function(){for(var e=0;e<t.length;e++)for(var o=t[e];o<this.MAP_ROW-1;o++)for(var i=0;i<this.MAP_COL;i++){var n=o*this.MAP_COL+i,r=n+this.MAP_COL;this.mapData[n]=this.mapData[r],null!=this.mapData[n]&&this.mapData[n].setPosition(o,i),this.mapData[r]=null}this.addRow(),this.setCurBlock(),this.nextBlock(),this.isRunning=!0},.5),!0)},e.prototype.setMapGrid=function(t){if(t.RealRow>=0&&t.RealRow<=this.MAP_ROW&&t.RealCol>=0&&t.RealCol<=this.MAP_COL){var e=t.RealRow*this.MAP_COL+t.RealCol;t.IsFalling=!1,this.mapData[e]=t}},e.prototype.getMapGrid=function(t,e){if(t>=0&&t<=this.MAP_ROW&&e>=0&&e<=this.MAP_COL){var o=t*this.MAP_COL+e;if(o<this.mapData.length)return this.mapData[o]}return null},e.prototype.rotateBlock=function(){c.BlockManager.getInstance().CurBlock.rotate()},e.prototype.clearMapGrid=function(t,e){if(t>=0&&t<=this.MAP_ROW&&e>=0&&e<=this.MAP_COL){var o=t*this.MAP_COL+e;o<this.mapData.length&&(this.mapData[o]=null)}},e.prototype.isGameOver=function(t){for(var e=0;e<t.getGrids().length;e++){var o=t.getGrids()[e];if(null!=this.getMapGrid(o.RealRow,o.RealCol))return!0}return!1},e.prototype.addRow=function(){if(this.toggleStepByStep.isChecked){for(var t=this.MAP_ROW-2;t>=0;t--)for(var e=0;e<this.MAP_COL;e++){var o=t*this.MAP_COL+e,i=o+this.MAP_COL;this.mapData[i]=this.mapData[o],null!=this.mapData[i]&&this.mapData[i].setPosition(t,e),this.mapData[o]=null}for(e=0;e<this.MAP_COL;e++)if(Math.floor(2*Math.random())%2==1){var n=new s.Grid(0,e);n.resetPosition(),n.Node.parent=this.nodeGame,this.mapData[e]=n}}},e.prototype.onKeyDown=function(t){if(this.isRunning)switch(t.keyCode){case cc.macro.KEY.a:case cc.macro.KEY.left:this.moveHorizontal(-1);break;case cc.macro.KEY.d:case cc.macro.KEY.right:this.moveHorizontal(1);break;case cc.macro.KEY.w:case cc.macro.KEY.up:this.rotateBlock();break;case cc.macro.KEY.s:case cc.macro.KEY.down:this.keyDown=!0}},e.prototype.onKeyUp=function(){this.keyDown=!1},e.prototype.onTouchStart=function(t){this.isRunning&&(this.touchStart=t.touch.getLocation())},e.prototype.onTouchMove=function(t){if(this.isRunning){var e=t.touch.getLocation();null!=this.touchStart&&(Math.abs(this.touchStart.x-e.x)>Math.abs(this.touchStart.y-e.y)?this.moveHorizontal(this.touchStart.x>e.x?-1:1):this.touchStart.y>e.y?this.keyDown=!0:this.rotateBlock(),this.touchStart=null)}},e.prototype.onTouchEnd=function(){this.isRunning&&(this.keyDown=!1,null!=this.touchStart&&(this.touchStart=null,this.rotateBlock()))},e.prototype.onClickToggleLine=function(){this.nodeLine.active=this.toggleLine.isChecked},e.prototype.onClickGameStart=function(){this.panelGameStart.active=!1,this.panelGameOver.active=!1,this.nodeIntro.active=!0,c.BlockManager.getInstance().clear(),this.startGame()},r([h(cc.Node)],e.prototype,"nodeGame",void 0),r([h(cc.Node)],e.prototype,"nodeNext",void 0),r([h(cc.Label)],e.prototype,"labelScore",void 0),r([h(cc.Prefab)],e.prototype,"prefabGrid",void 0),r([h(cc.Node)],e.prototype,"nodeIntro",void 0),r([h(cc.Slider)],e.prototype,"sliderSpeed",void 0),r([h(cc.Node)],e.prototype,"nodeLine",void 0),r([h(cc.Toggle)],e.prototype,"toggleLine",void 0),r([h(cc.Toggle)],e.prototype,"toggleColor",void 0),r([h(cc.Toggle)],e.prototype,"toggleMultiType",void 0),r([h(cc.Toggle)],e.prototype,"toggleStepByStep",void 0),r([h(cc.Node)],e.prototype,"panelGameStart",void 0),r([h(cc.Node)],e.prototype,"panelGameOver",void 0),r([l],e)}(cc.Component);o.default=p,cc._RF.pop()},{"./BlockManager":"BlockManager","./Grid":"Grid"}],Grid:[function(t,e,o){"use strict";cc._RF.push(e,"daef7DHoRFJfYXDV/KNehEI","Grid"),Object.defineProperty(o,"__esModule",{value:!0}),o.Grid=void 0;var i=t("./BlockManager"),n=function(){function t(t,e,o){this.SIZE=32,this._row=t,this._col=e,this._mapRow=0,this._mapRow=0,this._isFalling=!1,this._node=cc.instantiate(i.BlockManager.getInstance().GridPrefab),o&&(this._node.color=o)}return Object.defineProperty(t.prototype,"MapRow",{get:function(){return this._mapRow},set:function(t){this._mapRow=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"MapCol",{get:function(){return this._mapCol},set:function(t){this._mapCol=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"RealRow",{get:function(){return this._mapRow+this._row},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"RealCol",{get:function(){return this._mapCol+this._col},enumerable:!1,configurable:!0}),t.prototype.setRowCol=function(t,e){this._row=t,this._col=e},Object.defineProperty(t.prototype,"IsFalling",{get:function(){return this._isFalling},set:function(t){this._isFalling=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Node",{get:function(){return this._node},enumerable:!1,configurable:!0}),t.prototype.resetPosition=function(){this._node.setPosition(this.RealCol*this.SIZE,this.RealRow*this.SIZE)},t.prototype.setPosition=function(t,e){this._node.setPosition(e*this.SIZE,t*this.SIZE)},t.prototype.remove=function(){this._row=-1,this._col=-1,this._mapRow=-1,this._mapCol=-1,this._node.runAction(cc.sequence(cc.fadeOut(.5),cc.removeSelf()))},t}();o.Grid=n,cc._RF.pop()},{"./BlockManager":"BlockManager"}],"use_v2.1-2.2.1_cc.Toggle_event":[function(t,e){"use strict";cc._RF.push(e,"1d2f6OjEnxD5YW4pph6OwAh","use_v2.1-2.2.1_cc.Toggle_event"),cc.Toggle&&(cc.Toggle._triggerEventInScript_isChecked=!0),cc._RF.pop()},{}]},{},["Block","BlockConfig","BlockManager","Game","Grid","use_v2.1-2.2.1_cc.Toggle_event"]);