window.__require=function o(t,e,i){function r(n,c){if(!e[n]){if(!t[n]){var a=n.split("/");if(a=a[a.length-1],!t[a]){var h="function"==typeof __require&&__require;if(!c&&h)return h(a,!0);if(s)return s(a,!0);throw new Error("Cannot find module '"+n+"'")}n=a}var l=e[n]={exports:{}};t[n][0].call(l.exports,function(o){return r(t[n][1][o]||o)},l,l.exports,o,t,e,i)}return e[n].exports}for(var s="function"==typeof __require&&__require,n=0;n<i.length;n++)r(i[n]);return r}({Cell:[function(o,t){"use strict";cc._RF.push(t,"567e3eDBHBGNrXIk7TU2HRo","Cell");var e={2:"#ECE0D5",4:"#EBDCC2",8:"#F4A873",16:"#F18151",32:"#F1654D",64:"#F0462D",128:"#E8C65F",256:"#E7C34F",512:"#78C93A",1024:"#C9963A",2048:"#C2BC2F"};cc.Class({extends:cc.Component,properties:{bg:cc.Node,numLabel:cc.Label,num:{default:0,notify:function(){this.numLabel.string=this.num,this.numLabel.node.color=this.num<=4?cc.Color.BLACK:cc.Color.WHITE,this.bg.color=e[String(this.num)]?cc.color(e[String(this.num)]):cc.color("#ECE0D5")}}}}),cc._RF.pop()},{}],GameScene:[function(o,t){"use strict";cc._RF.push(t,"96793wKagVG8LHTdsirugZ2","GameScene"),cc.Class({extends:cc.Component,properties:{nodeCells:cc.Node,cellPF:cc.Prefab,scoreLabel:cc.Label,bestLabel:cc.Label,panel:cc.Node,panelLabel:cc.Label,score:{default:0,type:cc.Integer,notify:function(){this.scoreLabel.string=this.score,this.score>this.getBestScore()&&(this.setBestScore(this.score),this.bestLabel.string=this.score)}}},onLoad:function(){cc.debug.setDisplayStats(!1)},init:function(){this.reloadCell(),this.bestLabel.string=this.getBestScore()},start:function(){this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.game.canvas.focus(),this.init()},reloadCell:function(){this.panel.active=!1,this.moved=!1,this.moving=!1,this.score=0,this.nodeCells.destroyAllChildren(),this.boardCells=[],this.board=[];for(var o=0;o<4;o++){for(var t=[],e=[],i=0;i<4;i++)t[i]=0,e[i]=null;this.board.push(t),this.boardCells.push(e)}this.randomCell(),this.randomCell()},getPanelPos:function(o,t){return cc.v2(180*t-270,270-180*o)},onTouchMove:function(o){if(!this.moved){var t=o.getStartLocation(),e=o.getLocation().subSelf(t);if(Math.abs(e.x)>Math.abs(e.y)){if(Math.abs(e.x)<10)return;this.moved=!0,e.x>0?this.moveRight():this.moveLeft()}else{if(Math.abs(e.y)<10)return;this.moved=!0,e.y>0?this.moveUp():this.moveDown()}}},onTouchEnd:function(){this.moved=!1},onKeyDown:function(o){switch(o.keyCode){case cc.macro.KEY.up:this.moveUp();break;case cc.macro.KEY.down:this.moveDown();break;case cc.macro.KEY.left:this.moveLeft();break;case cc.macro.KEY.right:this.moveRight()}},randomCell:function(){for(var o=Math.round(3*Math.random()),t=Math.round(3*Math.random());0!=this.board[o][t];)o=Math.round(3*Math.random()),t=Math.round(3*Math.random());this.board[o][t]=2;var e=cc.instantiate(this.cellPF);e.parent=this.nodeCells,e.position=this.getPanelPos(o,t),e=e.getComponent("Cell"),this.boardCells[o][t]=e,e.num=2,e.bg.scale=0,e.bg.runAction(cc.scaleTo(.1,1))},canMoveUp:function(){for(var o=0;o<=3;o++)for(var t=1;t<=3;t++)if(0!=this.board[t][o]&&(0==this.board[t-1][o]||this.board[t-1][o]==this.board[t][o]))return!0;return!1},canMoveDown:function(){for(var o=0;o<=3;o++)for(var t=2;t>=0;t--)if(0!=this.board[t][o]&&(0==this.board[t+1][o]||this.board[t+1][o]==this.board[t][o]))return!0;return!1},canMoveLeft:function(){for(var o=3;o>=0;o--)for(var t=1;t<=3;t++)if(0!=this.board[o][t]&&(0==this.board[o][t-1]||this.board[o][t-1]==this.board[o][t]))return!0;return!1},canMoveRight:function(){for(var o=3;o>=0;o--)for(var t=2;t>=0;t--)if(0!=this.board[o][t]&&(0==this.board[o][t+1]||this.board[o][t+1]==this.board[o][t]))return!0;return!1},moveUp:function(){if(this.canMoveUp()&&!this.moving){for(var o=0;o<=3;o++)for(var t=0,e=0;e<=3;e++)if(0!=this.board[e][o])for(var i=0+t;i<e;i++)0==this.board[i][o]&&this.noBlockVertical(o,i,e)?(this.board[i][o]=this.board[e][o],this.board[e][o]=0,this.moveActionVertical(e,o,i,!1)):this.board[i][o]==this.board[e][o]&&this.noBlockVertical(o,i,e)&&(this.score+=2*this.board[e][o],this.board[i][o]+=this.board[e][o],this.board[e][o]=0,t++,this.moveActionVertical(e,o,i,!0));this.randomCell()}},moveDown:function(){if(this.canMoveDown()&&!this.moving){for(var o=0;o<=3;o++)for(var t=0,e=3;e>=0;e--)if(0!=this.board[e][o])for(var i=3-t;i>e;i--)0==this.board[i][o]&&this.noBlockVertical(o,e,i)?(this.board[i][o]=this.board[e][o],this.board[e][o]=0,this.moveActionVertical(e,o,i,!1)):this.board[i][o]==this.board[e][o]&&this.noBlockVertical(o,e,i)&&(this.score+=2*this.board[e][o],this.board[i][o]+=this.board[e][o],this.board[e][o]=0,t++,this.moveActionVertical(e,o,i,!0));this.randomCell()}},moveLeft:function(){if(this.canMoveLeft()&&!this.moving){for(var o=3;o>=0;o--)for(var t=0,e=0;e<=3;e++)if(0!=this.board[o][e])for(var i=0+t;i<e;i++)0==this.board[o][i]&&this.noBlockHorizonal(o,i,e)?(this.board[o][i]=this.board[o][e],this.board[o][e]=0,this.moveActionHorizonal(o,e,i,!1)):this.board[o][i]==this.board[o][e]&&this.noBlockHorizonal(o,i,e)&&(this.score+=2*this.board[o][e],this.board[o][i]+=this.board[o][e],this.board[o][e]=0,t++,this.moveActionHorizonal(o,e,i,!0));this.randomCell()}},moveRight:function(){if(this.canMoveRight()&&!this.moving){for(var o=3;o>=0;o--)for(var t=0,e=3;e>=0;e--)if(0!=this.board[o][e])for(var i=3-t;i>e;i--)0==this.board[o][i]&&this.noBlockHorizonal(o,e,i)?(this.board[o][i]=this.board[o][e],this.board[o][e]=0,this.moveActionHorizonal(o,e,i,!1)):this.board[o][i]==this.board[o][e]&&this.noBlockHorizonal(o,e,i)&&(this.score+=2*this.board[o][e],this.board[o][i]+=this.board[o][e],this.board[o][e]=0,t++,this.moveActionHorizonal(o,e,i,!0));this.randomCell()}},moveActionHorizonal:function(o,t,e,i){var r=this,s=this.boardCells[o][t];s&&(this.boardCells[o][t]=null,s.node.stopAllActions(),this.moving=!0,i?s.node.runAction(cc.sequence(cc.moveTo(.1,this.getPanelPos(o,e)),cc.callFunc(function(){r.boardCells[o][e].num=r.board[o][e],r.boardCells[o][e].bg.runAction(cc.sequence(cc.scaleTo(.1*.4,1.2),cc.delayTime(.1*.2),cc.scaleTo(.03,1))),s.node.destroy(),r.moving=!1,r.getGameResult(r.board[o][e])}))):(this.boardCells[o][e]=s,s.node.runAction(cc.sequence(cc.moveTo(.1,this.getPanelPos(o,e)),cc.callFunc(function(){r.moving=!1,r.getGameResult(r.board[o][e])})))))},moveActionVertical:function(o,t,e,i){var r=this,s=this.boardCells[o][t];s&&(this.boardCells[o][t]=null,s.node.stopAllActions(),this.moving=!0,i?s.node.runAction(cc.sequence(cc.moveTo(.1,this.getPanelPos(e,t)),cc.callFunc(function(){r.boardCells[e][t].num=r.board[e][t],r.boardCells[e][t].bg.runAction(cc.sequence(cc.scaleTo(.1*.4,1.2),cc.delayTime(.1*.2),cc.scaleTo(.03,1))),s.node.destroy(),r.moving=!1,r.getGameResult(r.board[e][t])}))):(this.boardCells[e][t]=s,s.node.runAction(cc.sequence(cc.moveTo(.1,this.getPanelPos(e,t)),cc.callFunc(function(){r.moving=!1,r.getGameResult(r.board[e][t])})))))},noBlockHorizonal:function(o,t,e){for(var i=t+1;i<e;i++)if(0!=this.board[o][i])return!1;return!0},noBlockVertical:function(o,t,e){for(var i=t+1;i<e;i++)if(0!=this.board[i][o])return!1;return!0},showGameSuc:function(){this.panelLabel.string="\u725b\u903c\uff0c\u518d\u6765\u4e00\u5c40\u5427!",this.panel.active=!0},showGameFail:function(){this.panelLabel.string="\u6e38\u620f\u5931\u8d25\uff0c\u518d\u8bd5\u4e00\u6b21\u5427!",this.panel.active=!0},getGameResult:function(o){2048!=o?this.getIsGameOver():this.showGameSuc()},getIsGameOver:function(){this.canMoveUp()||this.canMoveDown()||this.canMoveLeft()||this.canMoveRight()||this.showGameFail()},getBestScore:function(){return Number(cc.sys.localStorage.getItem("best"))||0},setBestScore:function(o){cc.sys.localStorage.setItem("best",o)}}),cc._RF.pop()},{}]},{},["Cell","GameScene"]);